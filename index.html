
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>물주기 사이트</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #eaf6ff;
      font-family: 'Arial', sans-serif;
      height: 100%;
      overflow: hidden;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100dvh;
    }

    .card {
      position: relative;
      width: 100%;
      max-width: 400px;
      height: 100%;
      max-height: 800px;
      background-color: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }

    .time-image, .plant-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .plant-overlay {
      z-index: 1;
      pointer-events: none;
    }

    .time-image {
      z-index: 0;
    }

    #물방울영역 {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
    }

    .drop {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      height: 800px;
      width: auto;
      animation: fall 1.5s ease-out forwards;
      z-index: 10;
      pointer-events: none;
      display: block;
    }

    @keyframes fall {
      0% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateX(-50%) translateY(360px);
        opacity: 0;
      }
    }

    .button-overlay {
      position: absolute;
      bottom: 20px;
      left: 0;
      width: 100%;
      text-align: center;
      z-index: 2;
    }

    #물뿌버튼 {
      width: 90%;
      max-width: 360px;
      cursor: pointer;
      transition: transform 0.1s;
    }

    #물뿌버튼:active {
      transform: scale(0.95);
    }

    .notice-image {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 4;
      display: none;
      width: 220px;
    }

    #totalCountDisplay {
      position: absolute;
      top: 10px;
      left: 12px;
      font-size: 30px;
      font-weight: bold;
      color: #a3dcff;
      z-index: 99;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <img id="timeImage" class="time-image" src="" alt="시간대 이미지" />
      <img class="plant-overlay" src="https://i.ibb.co/dsn0Wf9M/image.png" alt="식물" />
      <div id="물방울영역"></div>
      <img id="물다줬" class="notice-image" src="https://i.ibb.co/WW8hZ4GH/image.png" alt="이미 물 줌" />
      <img id="성공알림" class="notice-image" src="https://i.ibb.co/jxT5RQk/image.png" alt="물 주기 성공" />
      <div class="button-overlay">
        <img id="물뿌버튼" src="https://i.ibb.co/pjZWVgyb/image.png" alt="물뿌리기 버튼" />
      </div>
      <audio id="waterSound" src="https://files.catbox.moe/y7gz7b.mp3"></audio>
      <div id="totalCountDisplay">0</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, get, set, onValue } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBCuDyKgkDVwptjsQ_sepxq2WylrQWd8ok",
      authDomain: "smkug-dd359.firebaseapp.com",
      databaseURL: "https://smkug-dd359-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "smkug-dd359",
      storageBucket: "smkug-dd359.appspot.com",
      messagingSenderId: "16714972126",
      appId: "1:16714972126:web:fc40119945f5e0844d7b4f",
      measurementId: "G-CP8X2ZQ8XC"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const countRef = ref(db, "totalCount");
    const getToday = () => {
      const today = new Date();
      return `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
    };

    const display = document.getElementById("totalCountDisplay");
    const btn = document.getElementById("물뿌버튼");
    const waterSound = document.getElementById("waterSound");
    const noticeSuccess = document.getElementById("성공알림");
    const noticeAlready = document.getElementById("물다줬");
    const dropArea = document.getElementById("물방울영역");
    const timeImage = document.getElementById("timeImage");

    function updateTimeImage() {
      const hour = new Date().getHours();
      if (hour >= 6 && hour < 9) timeImage.src = "https://i.ibb.co/j9tjPRLR/image.png";
      else if (hour >= 9 && hour < 17) timeImage.src = "https://i.ibb.co/W40tb97w/image.png";
      else if (hour >= 17 && hour < 20) timeImage.src = "https://i.ibb.co/j9tjPRLR/image.png";
      else timeImage.src = "https://i.ibb.co/VpPc6gW0/image.png";
    }

    function createDrop() {
      const drop = document.createElement("img");
      drop.src = "https://i.postimg.cc/dQWRcKBW/01.png";
      drop.className = "drop";
      dropArea.appendChild(drop);
      drop.addEventListener("animationend", () => drop.remove());
    }

    onValue(countRef, (snap) => {
      display.textContent = snap.val() ?? 0;
    });

    btn.addEventListener("click", async () => {
      createDrop();
      waterSound.play();

      const ip = await fetch("https://api.ipify.org").then(res => res.text());
      const ipRef = ref(db, `ipLogs/${ip}`);
      const snap = await get(ipRef);

      const today = getToday();
      if (!snap.exists() || snap.val() !== today) {
        noticeSuccess.style.display = "block";
        setTimeout(() => noticeSuccess.style.display = "none", 2000);
        set(ipRef, today);
        const cSnap = await get(countRef);
        const current = cSnap.exists() ? cSnap.val() : 0;
        set(countRef, current + 1);
      } else {
        noticeAlready.style.display = "block";
        setTimeout(() => noticeAlready.style.display = "none", 2000);
      }
    });

    updateTimeImage();
  </script>
</body>
</html>
